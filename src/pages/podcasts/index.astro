---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import configData from '../../../data/config.json';

// Get all podcasts and sort by date (latest first)
// Parse date strings to Date objects for sorting
const parseDate = (dateString: string): Date => {
    // Handle formats like "April 26, 2023"
    const months: { [key: string]: number } = {
        'January': 0, 'February': 1, 'March': 2, 'April': 3,
        'May': 4, 'June': 5, 'July': 6, 'August': 7,
        'September': 8, 'October': 9, 'November': 10, 'December': 11
    };
    
    const parts = dateString.split(' ');
    if (parts.length === 3) {
        const month = months[parts[0]];
        const day = parseInt(parts[1].replace(',', ''));
        const year = parseInt(parts[2]);
        return new Date(year, month, day);
    }
    return new Date(dateString);
};

const podcasts = [...configData.podcasts]
    .map(podcast => ({
        ...podcast,
        publishedDate: parseDate(podcast.date)
    }))
    .sort((a, b) => b.publishedDate.getTime() - a.publishedDate.getTime());
---

<BaseLayout 
    title="Podcasts | 42 Interactive"
    description="Watch our latest podcasts and videos about technology, design, and innovation"
    bodyClass="podcasts-listing-page"
>
    <Header activePage="who-we-are" />
    
    <main class="main-content">
        <section class="podcasts-listing-section" data-theme="light">
            <div class="section-inner">
                <div class="section-header">
                    <h1 class="section-title">Podcasts</h1>
                    <p class="section-description">Latest videos and podcasts from 42 Interactive</p>
                </div>

                <div class="podcasts-grid grid-3col">
                    {podcasts.map((podcast) => (
                        <div 
                            class="podcast-card youtube-video-card"
                            data-video-id={podcast.id}
                        >
                            <div class="podcast-card-image-wrapper">
                                <img
                                    src={`https://img.youtube.com/vi/${podcast.id}/maxresdefault.jpg`}
                                    alt={podcast.title}
                                    class="podcast-image"
                                />
                                <div class="podcast-card-overlay">
                                    <div class="play-button">
                                        <svg
                                            width="68"
                                            height="48"
                                            viewBox="0 0 68 48"
                                            fill="none"
                                        >
                                            <path
                                                d="M66.52,7.74c-0.78-2.93-2.49-5.41-5.42-6.19C55.79,.13,34,0,34,0S12.21,.13,6.9,1.55 C3.97,2.33,2.27,4.81,1.48,7.74C0.06,13.05,0,24,0,24s0.06,10.95,1.48,16.26c0.78,2.93,2.49,5.41,5.42,6.19 C12.21,47.87,34,48,34,48s21.79-0.13,27.1-1.55c2.93-0.78,4.64-3.26,5.42-6.19C67.94,34.95,68,24,68,24S67.94,13.05,66.52,7.74z"
                                                fill="#f00"
                                            />
                                            <path
                                                d="M 45,24 27,14 27,34"
                                                fill="#fff"
                                            />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div class="podcast-card-content">
                                <h3 class="podcast-title">{podcast.title}</h3>
                                {podcast.description && (
                                    <p class="podcast-description">{podcast.description}</p>
                                )}
                                <p class="podcast-date">{podcast.date}</p>
                            </div>
                        </div>
                    ))}
                </div>
            </div>
        </section>
    </main>

    <Footer />
</BaseLayout>

<style>
    .podcasts-listing-section {
        background-color: #ffffff;
        padding: 80px 0;
        min-height: 60vh;
    }

    .section-header {
        margin-bottom: 60px;
        text-align: center;
    }

    .section-title {
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 20px;
        color: var(--text-dark, #0e1026);
    }

    .section-description {
        font-size: 1.2rem;
        color: #666666;
    }

    .podcasts-grid {
        margin-top: 40px;
        align-items: stretch; /* Ensure all cards have same height */
    }

    .podcast-card {
        display: flex;
        flex-direction: column;
        background: transparent;
        transition: transform 0.3s ease;
        border-radius: 8px;
        overflow: hidden;
        cursor: pointer;
        height: 100%; /* Ensure cards fill grid cell */
    }

    .podcast-card:hover {
        transform: translateY(-5px);
    }

    .podcast-card-image-wrapper {
        position: relative;
        width: 100%;
        height: 280px; /* Fixed height for consistency */
        overflow: hidden;
        background: var(--bg-gray);
        margin-bottom: 20px;
    }

    .podcast-image {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .podcast-card-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .podcast-card:hover .podcast-card-overlay {
        opacity: 1;
    }

    .play-button {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .play-button svg {
        width: 68px;
        height: 48px;
        transition: transform 0.3s ease;
    }

    .podcast-card:hover .play-button svg {
        transform: scale(1.1);
    }

    .podcast-card-content {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .podcast-title {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 12px;
        color: var(--text-dark, #0e1026);
        line-height: 1.4;
        min-height: 3.6em; /* Fixed height for title area (2 lines) */
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .podcast-description {
        font-size: 0.95rem;
        color: #666666;
        margin-bottom: 12px;
        line-height: 1.6;
        flex: 1;
        min-height: 3em; /* Minimum height for description */
    }

    .podcast-date {
        font-size: 0.85rem;
        color: #999999;
        margin-top: auto;
    }

    /* Responsive */
    @media (max-width: 1024px) {
        .podcasts-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .podcast-card-image-wrapper {
            height: 240px; /* Slightly smaller on tablet */
        }
    }

    @media (max-width: 768px) {
        .podcasts-listing-section {
            padding: 60px 0;
        }

        .section-title {
            font-size: 2rem;
        }

        .podcasts-grid {
            grid-template-columns: 1fr;
        }
        
        .podcast-card-image-wrapper {
            height: 200px; /* Smaller on mobile */
        }
        
        .podcast-title {
            min-height: auto; /* Allow natural height on mobile */
        }
    }
</style>

<script>
    // Initialize YouTube lightbox functionality for podcast cards
    // The existing youtube.js will handle .youtube-video-card elements
    document.addEventListener('DOMContentLoaded', function() {
        if (window.App && window.App.initYouTubeLightbox) {
            window.App.initYouTubeLightbox();
        }
    });
</script>

